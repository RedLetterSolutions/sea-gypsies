@page "/"
@rendermode InteractiveServer

<PageTitle>The Sea Gypsies</PageTitle>

<div id="loading" class="loading-screen">
    <div class="loading-content">
        <div class="spinner"></div>
        <p>Detecting device...</p>
    </div>
</div>

<style>
    .loading-screen {
        position: fixed;
        inset: 0;
        background: #256878;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    }

    .loading-content {
        text-align: center;
    }

    .spinner {
        width: 40px;
        height: 40px;
        border: 4px solid rgba(255, 255, 255, 0.3);
        border-top: 4px solid white;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 16px auto;
    }

    @@keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    .loading-content p {
        margin: 0;
        font-size: 14px;
        opacity: 0.8;
    }
</style>

@code {
    [Inject] private IJSRuntime JSRuntime { get; set; } = default!;
    [Inject] private NavigationManager Navigation { get; set; } = default!;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await Task.Delay(500); // Brief delay for loading animation

            try
            {
                // Detect if mobile device
                var isMobile = await JSRuntime.InvokeAsync<bool>("eval", @"
                    (function() {
                        const ua = navigator.userAgent || navigator.vendor || '';
                        const isCoarse = matchMedia('(pointer:coarse)').matches || 'ontouchstart' in window || navigator.maxTouchPoints > 1;
                        const isMobileUA = /Android|iPhone|iPad|iPod|Mobile|IEMobile|Opera Mini/i.test(ua);
                        const isSmallScreen = window.innerWidth <= 1100;
                        return isMobileUA || (isCoarse && isSmallScreen);
                    })()
                ");

                if (isMobile)
                {
                    Navigation.NavigateTo("/mobile", replace: true);
                }
                else
                {
                    Navigation.NavigateTo("/desktop", replace: true);
                }
            }
            catch
            {
                // Fallback to desktop if detection fails
                Navigation.NavigateTo("/desktop", replace: true);
            }
        }
    }
}